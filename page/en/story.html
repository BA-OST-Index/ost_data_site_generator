{% extends "template/en/base.html" %}

{% block title %}Story/{{ story.name.en }}{% endblock title %}
{% block article_content %}
    {% from "template/en/_macro.html" import get_ordinal_number, output_usedby_character, output_usedby_track_list, output_usedby_background_list, track_type_for_show %}

    <h1>Story/<span class="{% if story.is_battle %}text-danger{% elif story.is_memory %}text-momo{% else %}text-primary{% endif %}">{{ story.name.en }}</span></h1>
    {% include "template/en/infobox/story.html" %}
    {% if story.filetype == 11 %}
        <p><b>{{ story.name.en }}</b> is the {{ get_ordinal_number(story.pos.segment) }} story of Chapter {{ story.pos.chapter }}, Volume {{ story.pos.volume }} of the main story.</p>
    {% elif story.filetype == 15 %}
        <p><b>{{ story.name.en }}</b> is the {{ get_ordinal_number(story.pos.no) }} story of the bond story of the student <img src="/static/images/student/icon/{{ story.student.image.collection_texture }}.webp" class="icon-stu"/>{{ story.student.name.personal_name.en }}.</p>
    {% elif story.filetype == 14 %}
        <p><b>{{ story.name.en }}</b> is the {{ get_ordinal_number(story.pos.segment) }} story of the event {{ story.parent_data.0.name.en }}.</p>
    {% else %}
        <p><b>{{ story.name.en }}</b> is the {{ get_ordinal_number(story.pos.no) }} story of Chapter {{ story.pos.chapter }} of story {{ story.parent_data.1.name.en }}.</p>
    {% endif %}
    <p>Descriptions:</p>
    <ul>
        {% for desc in story.desc %}
            <li>{{ desc.en }}</li>
        {% endfor %}
    </ul>

    <h2>Battle/Bond Track Info</h2>
    {% if story.is_battle or story.is_memory %}
        <ul>
            {% for track in story.bgm_special %}
                <li>{{ track_type_for_show(track) }}&nbsp;<a href="/en/track/{{ track.namespace.1 }}/{{ track.namespace.2 }}.html">{{ track.no }}. {{ track.name.realname.en }}</a></li>
            {% endfor %}
        </ul>
    {% else %}
        <p>This story contains no battle/recollection lobby part, therefore there's no such track information.</p>
    {% endif %}

    <h2>Story Parts</h2>
    {% for part in story.part %}
        {% if part.is_memory %}<h3 class="text-momo"{% elif part.is_battle %}<h3 class="text-danger"{% elif part.is_momotalk %}<h3{% else %}<h3 class="text-primary"{% endif %} id="story-part-{{ loop.index }}">{{ loop.index }}. {{ part.name.en }}</h3>
        <p>{{ part.desc.en }}</p>
        <h4>Characters</h4>
        {% if part.is_battle %}
            {{ output_usedby_character(part, "story-" + story.instance_id, story.instance_id, "story", "True", part.battle_leader_pos) }}
        {% else %}
            {{ output_usedby_character(part, "story-" + story.instance_id, story.instance_id, "story") }}
        {% endif %}
        <h4>Tracks</h4>
        {{ output_usedby_track_list(part.track, "story-" + story.instance_id, "story", story.instance_id) }}
        <h4>Backgrounds</h4>
        {{ output_usedby_background_list(part.background, "story-" + story.instance_id, story.instance_id, "story") }}
    {% else %}
        <p>Nothing to show!</p>
    {% endfor %}
{% endblock %}