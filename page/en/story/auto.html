{% from "template/en/_macro_page.html" import output_usedby_track, output_usedby_background %}
{% set actual_data = story.part %}

<h2>Story Data</h2>
<p>This story's data is <b>auto-generated by scripts</b> and no manual tuning involved. Below are part of the data relationships we manage to obtain.</p>
<h3>All Data</h3>
{% set actual_data_all = actual_data.all %}
<h4>Characters</h4>
{{ output_usedby_character({"character": actual_data_all.character.values()}, "story-" + story.instance_id, story.instance_id, "story") }}
<h4>Tracks</h4>
{{ output_usedby_track_list(actual_data_all.track.values(), "story-" + story.instance_id, "story", story.instance_id) }}
<h4>Backgrounds</h4>
{{ output_usedby_background_list(actual_data_all.background.values(), "story-" + story.instance_id, story.instance_id, "story") }}
<h3>Inter-data Relationships</h3>
<p>Below shows the inter-data relationships. Be reminded that we're using internal "instance_id" for display; the data shown is for quick reference only.</p>
<h4>Tracks</h4>
<ul>
    {% for track_id in actual_data.all.track.keys() %}
        <li><code>{{ track_id }}</code></li>
        <ul>
            <li>Backgrounds：{% for bg_id in actual_data._track_to_bg[track_id] %}<code>{{ bg_id }}</code>、{% endfor %}</li>
            <li>Characters：{% for char_id in actual_data.track_to_char[track_id] %}<code>{{ char_id }}</code>、{% endfor %}</li>
        </ul>
    {% endfor %}
</ul>
<h4>Characters</h4>
<ul>
    {% for char_id in actual_data.all.character.keys() %}
        <li><code>{{ char_id }}</code></li>
        <ul>
            <li>Backgrounds：{% for bg_id in actual_data._char_to_bg[char_id] %}<code>{{ bg_id }}</code>、{% endfor %}</li>
            <li>Tracks：{% for track_id in actual_data.char_to_track[char_id] %}<code>{{ track_id }}</code>、{% endfor %}</li>
            <li>Characters：{% for char2_id in actual_data.char_to_char[char_id] %}<code>{{ char2_id }}</code>、{% endfor %}</li>
        </ul>
    {% endfor %}
</ul>
<h4>Backgrounds</h4>
<ul>
    {% for bg_id in actual_data.all.background.keys() %}
        <li><code>{{ bg_id }}</code></li>
        <ul>
            <li>Characters：{% for char_id in actual_data._bg_to_char[bg_id] %}<code>{{ char_id }}</code>、{% endfor %}</li>
            <li>Tracks：{% for track_id in actual_data.bg_to_track[bg_id] %}<code>{{ track_id }}</code>、{% endfor %}</li>
        </ul>
    {% endfor %}
</ul>
